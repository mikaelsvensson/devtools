<?xml version="1.0" encoding="UTF-8"?>
<document>
    <subsection name="About">
        <p>The application will generate a report which will look something like this:</p>
        <pre><![CDATA[
    Accumulated Execution Time
    --------------------------

       Samples       Time   Time Timing Details                                               Query Id Query String
       -------       ----   ---- --------------                                               -------- ------------
        214036    16992 s  80,6% Prepare: 12 s, Describe: 3 s, Open: 6 s, Close: 16970 s      17       select ...
       3565440     1378 s   6,5% Prepare: 143 s, Describe: 64 s, Open: 124 s, Close: 1046 s   8        select ...
        239528      375 s   1,8% Prepare: 11 s, Describe: 4 s, Open: 8 s, Close: 352 s        9        select ...
        203664      285 s   1,4% Prepare: 10 s, Describe: 3 s, Open: 7 s, Close: 265 s        11       select ...
        832180      241 s   1,1% Prepare: 30 s, Describe: 13 s, Open: 26 s, Close: 172 s      10       select ...
    ...
       -------       ----   ---- --------------                                               -------- ------------
       7377312    21086 s

    Accumulated execution time according to Elapsed Execution Time values: 21086 s
    Period of time when logging was enabled according to time stamps:      4212 s

    Number of Calls
    ---------------

       Samples       Time   Time Timing Details                                               Query Id Query String
       -------       ----   ---- --------------                                               -------- ------------
       3565440     1378 s   6,5% Prepare: 143 s, Describe: 64 s, Open: 124 s, Close: 1046 s   8        select ...
        832180      241 s   1,1% Prepare: 30 s, Describe: 13 s, Open: 26 s, Close: 172 s      10       select ...
        239528      375 s   1,8% Prepare: 11 s, Describe: 4 s, Open: 8 s, Close: 352 s        9        select ...
        232136      153 s   0,7% Prepare: 11 s, Describe: 4 s, Open: 8 s, Close: 131 s        15       select ...
        214036    16992 s  80,6% Prepare: 12 s, Describe: 3 s, Open: 6 s, Close: 16970 s      17       select ...
    ...
       -------       ----   ---- --------------                                               -------- ------------
       7377312    21086 s

    Accumulated execution time according to Elapsed Execution Time values: 21086 s
    Period of time when logging was enabled according to time stamps:      4212 s
    ]]></pre>
        <p>
            Note the obvious problem with the recorded execution time: The accumulated execution time for the queries my
            greatly exceed the number of seconds between the earliest and latest recorded event. There may be several
            plausible reasons for this discrepancy, including rounding errors and concurrent query execution.
        </p>
    </subsection>
    <subsection name="How Do I Make DB2 Record This Log?">
        <p>Producing the necessary input to this report generator involves creating a monitor in the DB2 database, as
            per these instructions:
        </p>

        <p>Start logging:</p>
        <ol>
            <li>Create event monitor:
                <br/>
                <code>db2 "CREATE EVENT MONITOR stmon FOR STATEMENTS WRITE TO FILE '/tmp'"</code>
            </li>
            <li>Turn on event monitor:
                <br/>
                <code>db2 SET EVENT MONITOR stmon STATE 1</code>
            </li>
        </ol>
        <p>Stop logging:</p>
        <ol>
            <li>Turn off event monitor:
                <br/>
                <code>db2 SET EVENT MONITOR stmon STATE 0</code>
            </li>
            <li>Delete event monitor:
                <br/>
                <code>db2 DROP EVENT MONITOR stmon</code>
            </li>
            <li>Translate event monitor into readable stuff:
                <br/>
                <code>db2evmon -path /tmp > /tmp/db2events.txt</code>
            </li>
        </ol>
        <p>The resulting <code>db2events.txt</code> is the input to the Db2EventLogReport utility.</p>

        <p>Some notes:</p>
        <ul>
            <li>Make sure you have got write permissions to log folder ("/tmp" in example above).</li>
            <li>The log files generated by the event monitor are stored in a binary format and thus not readable to
                humans.
            </li>
            <li>The db2evmon utility converts the binary log files to a very verbose text format. These text files can
                easily become several gigabytes in size since EACH query adds almost 2-3 KB to the text file (depending
                on the SQL querytext).
            </li>
        </ul>
    </subsection>
    <subsection name="Notes">

        <p>You may specify multiple input paths (i.e. log files). The utility will process them one by one.</p>

    </subsection>
    <subsection name="Compiling">
        <p>
            <code>analysis$ mvn clean install dependency:copy-dependencies</code>
        </p>
    </subsection>
</document>